<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Continuidad Pro - GestiÃ³n de Emergencias</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <header>
        <h1>ğŸ¥ Sistema de Continuidad del Negocio</h1>
        <div style="display: flex; align-items: center; gap: 20px;">
            <span id="displayUserName" style="font-size: 14px; font-weight: 600;"></span>
            <button type="button" id="btnLogout" class="btn-info" style="width: auto; padding: 5px 15px; background: #ef4444; color: white; border: none; margin:0">ğŸšª Cerrar SesiÃ³n</button>
        </div>
    </header>

    <div class="main-wrapper">
        <aside id="panel-controles">
            <label>ğŸš¨ Nivel de Alerta</label>
            <select id="nivelAlerta">
                <option value="CrÃ­tica (Roja)">ğŸ”´ CrÃ­tica (Roja)</option>
                <option value="Alta (Naranja)">ğŸŸ  Alta (Naranja)</option>
                <option value="Media (Amarilla)">ğŸŸ¡ Media (Amarilla)</option>
                <option value="Informativa (Azul)">ğŸ”µ Informativa (Azul)</option>
            </select>
            <label>ğŸ“ Tipo de Evento</label>
            <select id="tipoEvento">
                <option value="Desastre natural">Desastre natural</option>
                <option value="Incendio">Incendio</option>
                <option value="Fallo servicios pÃºblicos">Fallo de servicios pÃºblicos</option>
                <option value="Emergencia de seguridad">Emergencia de seguridad</option>
            </select>
            <label>ğŸ“ DescripciÃ³n Detallada</label>
            <textarea id="descripcionEvento" placeholder="Describe el evento aquÃ­..."></textarea>
            <label>ğŸ” Buscar DirecciÃ³n</label>
            <input type="text" id="direccionBuscar" placeholder="Ej: Calle 100, BogotÃ¡">
            <button type="button" id="btnBuscarDireccion" class="btn-secondary">ğŸ” Buscar</button>
            <div class="card-analitica"><label><input type="checkbox" id="toggleHeatmap"> ğŸ”¥ Mapa de Calor</label></div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button type="button" id="btnVerDashboard" class="btn-info">ğŸ“ˆ Dashboard</button>
                <button type="button" id="btnVerHistorial" class="btn-info">ğŸ“‹ Historial</button>
            </div>
            <button type="button" id="btnAdmin" class="btn-primary" style="background: #475569; display: none;">âš™ï¸ Panel Administrativo</button>
            <button type="button" id="btnGenerarResumen" class="btn-primary">ğŸ“Š GENERAR IMPACTO</button>
            <button type="button" id="btnDescargarPDF" class="btn-success">ğŸ“¥ DESCARGAR INFORME</button>
        </aside>
        <main id="map"></main>
    </div>

    <div id="panel-resultados">
        <div id="infoResumen"></div>
        <div class="stats-container"></div>
        <div class="grafica-container"><canvas id="graficaSedes"></canvas></div>
        <div id="listaSedesAfectadas"></div>
    </div>

    <!-- MODAL ADMIN CON PESTAÃ‘AS -->
    <div id="modalAdmin" class="modal"><div class="modal-content">
        <div class="modal-header">
            <div style="display:flex; gap:15px; align-items:center;">
                <h2>âš™ï¸ AdministraciÃ³n</h2>
                <button type="button" class="btn-info" style="width:auto; margin:0" onclick="switchTab('tab-users')">ğŸ‘¥ Usuarios</button>
                <button type="button" class="btn-info" style="width:auto; margin:0" onclick="switchTab('tab-sedes')">ğŸ¢ Sedes</button>
            </div>
            <span class="btn-close" id="cerrarAdmin">&times;</span>
        </div>
        <div class="modal-body">
            <!-- PESTAÃ‘A USUARIOS -->
            <div id="tab-users" class="admin-tab">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div style="background:#f8fafc; padding:15px; border-radius:12px; border:1px solid #e2e8f0;">
                        <h3>Listado de Usuarios</h3>
                        <div id="listaUsuariosAdmin" style="max-height:400px; overflow-y:auto;"></div>
                    </div>
                    <div style="background:#f8fafc; padding:15px; border-radius:12px; border:1px solid #e2e8f0;">
                        <h3 id="userFormTitle">â• Nuevo Usuario</h3>
                        <input type="hidden" id="adm_user_id">
                        <input type="text" id="adm_user_full" placeholder="Nombre Completo">
                        <input type="text" id="adm_user_name" placeholder="Usuario">
                        <input type="password" id="adm_user_pass" placeholder="ContraseÃ±a (opcional si edita)">
                        <select id="adm_user_role">
                            <option value="analista">Analista</option>
                            <option value="admin">Administrador</option>
                        </select>
                        <button type="button" class="btn-primary" onclick="guardarUsuario()">Guardar Usuario</button>
                        <button type="button" class="btn-secondary" onclick="limpiarFormUser()">Limpiar</button>
                    </div>
                </div>
            </div>
            <!-- PESTAÃ‘A SEDES -->
            <div id="tab-sedes" class="admin-tab" style="display:none">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div style="background:#f8fafc; padding:15px; border-radius:12px; border:1px solid #e2e8f0;">
                        <h3>Listado de Sedes</h3>
                        <div id="listaSedesAdmin" style="max-height:400px; overflow-y:auto;"></div>
                    </div>
                    <div style="background:#f8fafc; padding:15px; border-radius:12px; border:1px solid #e2e8f0;">
                        <h3 id="sedeFormTitle">â• Gestionar Sede</h3>
                        <input type="hidden" id="adm_sede_id">
                        <input type="text" id="adm_sede_nom" placeholder="Nombre">
                        <input type="text" id="adm_sede_dir" placeholder="DirecciÃ³n">
                        <div style="display:flex; gap:5px">
                            <input type="number" step="any" id="adm_sede_lat" placeholder="Latitud">
                            <input type="number" step="any" id="adm_sede_lng" placeholder="Longitud">
                            <button type="button" class="btn-info" style="width: auto; margin-top: 5px; padding: 0 10px;" onclick="iniciarCapturaMapa()">ğŸ“</button>
                        </div>
                        <button type="button" class="btn-success" onclick="guardarSede()">Guardar Sede</button>
                        <button type="button" class="btn-secondary" onclick="limpiarFormSede()">Limpiar</button>
                    </div>
                </div>
            </div>
        </div>
    </div></div>

    <!-- MODAL DASHBOARD -->
    <div id="modalDashboard" class="modal"><div class="modal-content">
        <div class="modal-header"><h2>ğŸ“ˆ Vulnerabilidad</h2><button type="button" id="btnExportarExcel" class="btn-success" style="width:auto">Excel</button><span class="btn-close" id="cerrarDashboard">&times;</span></div>
        <div class="modal-body" style="height:450px"><canvas id="graficaVulnerabilidad"></canvas></div>
    </div></div>

    <!-- MODAL HISTORIAL -->
    <div id="modalHistorial" class="modal"><div class="modal-content">
        <div class="modal-header"><h2>ğŸ“œ Historial</h2><button type="button" id="btnExportarHistorial" class="btn-success" style="width:auto">CSV</button><span class="btn-close" id="cerrarHistorial">&times;</span></div>
        <div class="modal-body" id="listaHistorialItems"></div>
    </div></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="js/map.js"></script>
</body>
</html>